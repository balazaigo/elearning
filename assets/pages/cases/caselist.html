<div class="container-fluid case_details">
    <div class="row">
        <div class="col-12 title-head mb-3">
        <div class="row w-100">

          <div class="wrapper">
            <input type="hidden" class="cases_flinkto" id="case_id_name"/>
            <input type="hidden" id="member_id" val=""/>
            <input type="hidden" id="case_id_mod" href="cases/caselist" data-flinkto="caselist" class="navigate_refresh cases_flinkto">
            <div class="left_icon">
              <li style="list-style: none;">
                <a href="cases/case" data-flinkto="cases" id="back_icon_cases">
                  <img src="../assets/images/left_arrow.png" class="arrow_icon">
                </a>
              </li>
            </div>
            <div class="course_head">
              <h4 class="header_content" id="case_ind_name_text"></h4>

              <input type="text" id="case_ind_name_input" onblur="toTextHeader();" value="" style="display: none;">
               <a id="text_edit_img_header" style="display: inline-flex;" onclick="toInputHeader();"><img src="../assets/images/pen-edit.jpg"></a>
              <dfn data-info="Lorem ipsum dolor sit amet, perspiciatis consectetur dolor."><i class="fas fa-info-circle"></i></dfn>
              <h4 id="case_ind_desc_text" class="case_ind_desc_text"></h4>
            </div>
            <!--<div class="course_head_right">
              <ul>
                <li> <div class="col-6 cleft tbtn course_header_box" id="course_id_prefix"> </div>
                 <span class="border-btn"><a href="#">
                  <button id="course_id_prefix"></button>
                  </a></span> 
                </li>
              </ul>
            </div>-->
            <input type="hidden" data-flinkto="caseslist" id="case_details" onload="get_case_module(this);" />
        </div>
            	<!--<div class="col-md-8">
                    <input type="hidden" data-flinkto="cases" id="case_id_name"/>
                    <input type="hidden" id="member_id" val=""/>
                    <input type="hidden" id="case_id_mod" data-flinkto="caseslist">
                <h2><span class="back"><a  data-flinkto="cases"><i class="fas fa-arrow-left" data-flinkto="cases"></i></a></span> <small id="case_ind_name_text"></small>
                    <input type="text" id="case_ind_name_input" onblur="toTextHeader();" value="" style="display: none;">
                     <a id="text_edit_img_header" onclick="toInputHeader();"><img src="../assets/images/pen-edit.jpg"></a>
                    <dfn data-info="Lorem ipsum dolor sit amet, perspiciatis consectetur dolor."><i class="fas fa-info-circle"></i></dfn> -->
                    <!-- in this page we don't need breadcumbs, So Commented it-->
                    <!--<span><a href="#">Breadcumbs1</a> <a href="#">Breadcumbs2</a></span> -->
                   <!-- <span id="case_ind_desc_text"></span>
                </h2>
                </div> -->
                <!--<div class="col-md-4 p-0 side-btn">
                    <ul>
                      <li> <span class="orange-btn"><a href="#">-->
                        <!--<button>Save</button>-->
                        <!--</a></span> </li>                
                    </ul>
                  </div> -->              
            </div>           
          
        </div>
    </div>
</div>
<div class="col-md-12 p-3 br-5 caselist" id="caselists">
</div>
<div class="modal fade" id="popup_course_icon" data-bs-backdrop="static">';
  <div class="modal-dialog modal-lg">
    <div class="modal-content" id="content-courseModule"></div>
  </div>
</div>

<div class="modal fade" id="mAlert" tabindex="-1" aria-labelledby="exampleModalCenterTitle" style="display: none;top:0;" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 600px;">
    <div class="modal-content delete_caseModule">
    </div>
  </div>
</div>
<!--<div id="mAlert" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mAlertCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-confirm">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="modal-title"><span id="mAlertName"></span></h6>
        <a class="close" data-bs-dismiss="modal">Ã—</a>
      </div>
      <div class="modal-body text-center">
        <div class="col-md-12 text-center mb-2"> <img src="../assets/images/delete.png" alt="Delete"> </div>
        <input type="hidden" id="mAlertURL" value="" />
        <p>Are you sure you want to delete it?</p>
      </div>
      <div class="modal-footer justify-content-center">
        <span class="dborder-btn nbtn">
          <button type="button" id="mAlertCancelCaseMod" class="btn btn-default" data-bs-dismiss="modal">Cancel</button>
        </span>
        <span class="danger-btn nbtn">
          <button type="button" id="mAlertDeleteCaseMod" class="btn btn-danger">Yes Delete</button>
        </span>
      </div>
    </div>
  </div>
</div>-->
<script type="text/javascript">
    let queries_param = getUrlParamquery();

    if(queries_param.page_from && queries_param.page_from == 'task'){
      document.getElementById("back_icon_cases").setAttribute("href", "task/task");
      document.getElementById("back_icon_cases").setAttribute("data-flinkto", "task");
    }
    var case_flinkto_elem = document.querySelectorAll(".cases_flinkto");
    case_flinkto_elem.forEach(el=>{
      el.setAttribute("data-case_id", queries_param.case_id);
      el.setAttribute("data-case_name", decodeURI(queries_param.case_name));
    });
    $(document).ready(function(){
        setTimeout(function(){
            let case_id = document.getElementById("case_id_name").getAttribute("data-case_id");
            let case_name = document.getElementById("case_id_name").getAttribute("data-case_name");
            if(case_id){
                $.ajax({
                    url: API_CONTENT_URL + '/cases/'+case_id+'/modules',
                    type: 'get',
                    dataType: 'json',
                    headers: { "Content-type": "application/json; charset=UTF-8", "Authorization": "Bearer " + getUserInfo().access_token },
                    success: function (response) {
                        var dots = "";
                        if(response.description.length > 75){
                            dots = "...";
                        }
                        var dots2 = "";
                        if(response.case_name.length > 75){
                            dots2 = "...";
                        }
                        if(response.children !== null){
                          var result = response.children.length + 1;
                        } else{
                          var result = 1;
                        }
                        $("#case_ind_name_text").text(response.case_name.substring(0, 75)+dots2);
                        $("#case_ind_name_text").attr('data-prev_val',response.case_name);
                        $("#case_ind_desc_text").text(response.description.substring(0, 75)+dots);
                        $("#member_id").val(response.member_id);
                        var newDIV = $("<ul class='course case_list_module_box sortablecase' id='case_box'></ul>");
                        var outerHtml = '';
                        if(response.children !== null){
                          get_list_mod( response.children, newDIV, 1, response.case_name);
                        }
                        newHTML = "<li class='module module_"+result+" main_mod_empty no_child' style='opacity:0.5;'>";
                        newHTML += "<div>";
                        newHTML += "<span class='course_img_icon disp_in_block flt_left' style='pointer-events:none;'><img src='../assets/images/course-icon.png' class='course_icon'></span>";
                        newHTML += "<span class='module_input disp_in_block flt_left'><input type='text' class='input_module_fld' id='module_inp' placeholder='Add Module Name' onChange='check_value_case_mod(this);' value=''onblur='totext_case_mod(this);' style='display: none;' maxlength='256'><p id='module_module_"+result+"' data-prev_val='Add Module Name' data-case_id='' data-case_module_id=''>Add Module Name <img src='../assets/images/pen-edit.jpg' onclick='toinput_case_mod(this);'></p></span>";
                        newHTML += "<span class='expand_img_icon disp_in_block flt_right'><img src='../assets/images/arrow_up_icon.png' class='expand_icon' onclick='toggle_collapse_expand_case_mod(this);'></span>";
                        //newHTML += "<li class='dots_img_icon disp_in_block flt_right' style='pointer-events:none;'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton3' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-ellipsis-v'></i></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton3'><li><a class='dropdown-item' data-case_id=''  data-case_module_id=''>Edit</a></li><li><a data-bs-toggle='modal' data-bs-target='#mAlert' data-module_name='' data-case_id=''  data-case_module_id='' class='dropdown-item' onClick='delete_case_module_confirm(this)'>Delete</a></li></ul></li>";
                        newHTML += "<span class='dots_img_icon disp_in_block flt_right' style='pointer-events:none;'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton3' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-ellipsis-v'></i></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton3'><span><a data-module_name='' data-case_id=''  data-case_module_id='' class='dropdown-item' onClick='delete_case_module_confirm(this)'>Delete</a></span></ul></span>";
                        //newHTML += "<li class='progress_btn disp_in_block flt_right'><p class='status_new'>New</p></li>";
                        newHTML += "<span class='attach_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/attach-icon.png' class='attach_icon' onClick='show_attachment_popup_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                        newHTML += "<span class='message_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/message-icon.png' class='message_icon' onClick='show_message_popup_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                        newHTML += "<span class='user_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/user-icon.png' class='user_icon' onClick='show_assignee_popup_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                        newHTML += "<span class='frame_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/frame-icon.png' class='frame_icon' onclick='show_tag_popup_case_mod(this)' data-getresult='tag' data-case_id='' data-case_module_id=''></span>";
                        newHTML += "<span class='plus_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/plus-icon.png' class='plus_icon' onClick='add_sub_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                        newHTML += "</div>";
                        newHTML += "</li>";
                        newDIV.append(newHTML);
                        var outerHtml = newDIV.prop('outerHTML');
                        document.getElementById("caselists").innerHTML = outerHtml;

                        var ns = $('.sortablecase').nestedSortable({
                          scroll: true,
                          forcePlaceholderSize: true,
                          listType:"ul",
                          handle: 'div',
                          helper: 'clone',
                          items: 'li',
                          toleranceElement: 'div>',
                          opacity: .6,
                          placeholder: 'placeholder',
                          revert: 250,
                          isTree: true,
                          expandOnHover: 700,
                          startCollapsed: false,
                          update: function(event, ui){
                            var item = ui.item;
                            var target = ui.item.parent().parent();
                            var parent_id = target.children().eq(0).children().eq(1).children().eq(0).attr("data-case_module_id");
                            var parent_id_val = "";
                            if(parent_id){
                              parent_id_val = String(parent_id);
                            }else{
                              parent_id_val = null;
                            }
                            var module_id = item.children().eq(0).children().eq(1).children().eq(0).attr("data-case_module_id");
                            var level_number = item.index() + 1;
                            if(item.children().eq(0).children().eq(1).children().eq(0).attr("data-flinkto")){
                              var module_name = item.children().eq(0).children().eq(2).children().eq(1).attr("data-prev_val");
                            }else{
                              var module_name = item.children().eq(0).children().eq(1).children().eq(1).attr("data-prev_val");
                            }
                            var get_submodule_level_values = {
                              module_name: String(decodeURIComponent(module_name)),
                              level: parseInt(level_number), 
                              case_id:String(document.getElementById("case_id_name").getAttribute("data-case_id")),
                              parent_id:parent_id_val
                            }

                            var url = API_CONTENT_URL + '/case_modules/'+module_id+'/';
                            var method = "PUT";
                            $.ajax({
                              url: url,
                              type: method,
                              data: JSON.stringify(get_submodule_level_values),
                              headers: { "Content-type": "application/json; charset=UTF-8", "Authorization": "Bearer " + getUserInfo().access_token },
                              success:function(response){
                                console.log(response);
                                //$("#case_id_mod").trigger("click");
                                location.reload();
                              },
                              error: function(error) {
                                if (error.status === 401) {
                                  alert("Session Expired, Please login again.");
                                  logoutSession();
                                }
                                tags_response = "1";
                                toastr.error("Response Error: " + error.message);
                                console.log(error);
                              }
                            });
                          
                          }
                        });
                    },
                    error: function(error) {
                        if (error.status === 401) {
                          alert("Session Expired, Please login again.");
                          logoutSession();
                        }
                        toastr.error("Response Error: " + error.message);
                        console.log(error);
                    }
                });
            }
        }, 0);
    });
/***************Case Modules Get Json and assign Tree structured format and Design Starts Here*************/
function get_list_mod( a, $parent , level_count_inc, case_name) {
  var levels = '';
  var newDIV = $("<div></div>");
  for (var i = 0; i < a.length; i++) {
      if (a[i]) {
          var level_count = a[i].module_name.split("/").length - 1;
          if(a[i].parent_id == null){
            var n = a[i].module_name.lastIndexOf('/');
            var dots = "";
            if(a[i].module_name.length > 75){
                dots = "...";
            }
            var input_value_substr = a[i].module_name.substring(0, 75)+dots;
            var input_value = a[i].module_name.substring(n + 1);
            var prevent_click = "";
            if(a[i].can_access == false){
              prevent_click = "pointer-events:none;";
            }
            if(a[i].is_qa == true){
                if (a[i].children.length > 0){
                    newDIV = $("<li class='module module_"+a[i].level+" main_mod' id='"+a[i].level+"' style='opacity:1'></li>");
                }else{
                    newDIV = $("<li class='module module_"+a[i].level+" main_mod' id='"+a[i].level+"' style='opacity:1'></li>");
                }
            }else{

                if (a[i].children.length > 0){
                    newDIV = $("<li class='module module_"+a[i].level+" main_mod has_child' id='"+a[i].level+"'  style='opacity:1'></li>");
                }else{
                    newDIV = $("<li class='module module_"+a[i].level+" main_mod no_child' id='"+a[i].level+"'  style='opacity:1'></li>");
                }
            }
            newUl = $("<ul class='main_module module_opacity' style='opacity:1'></ul>");
            newUlDIV = $("<div></div>");
            newUlDIV.append("<span class='course_img_icon disp_in_block flt_left' style='"+prevent_click+"'><img src='../assets/images/course-icon.png' class='course_icon'></span>");

            if(a[i].is_qa == true){
              newUlDIV.append("<span class='course_img_icon disp_in_block flt_left' style='"+prevent_click+"'><img src='../assets/images/pad.jpg' class='expand_icon navigate_refresh' href='cases/knowledgecheck' data-flinkto='knowledgecheck' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"' data-case_name='"+case_name+"' data-case_module_name='"+input_value+"'></span>");

              newUlDIV.append("<span class='module_input disp_in_block flt_left' style='"+prevent_click+"'><input type='text' class='input_module_fld' id='module_inp' placeholder='Add Module Name' onChange='check_value_case_mod(this);' value='"+parseString(input_value)+"'onblur='totext_case_mod(this);' style='display: none;' maxlength='256'  data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'><p id='module_module_"+level_count_inc+"' data-prev_val='"+encodeURIComponent(parseString(input_value))+"' class='main_mod_title navigate_refresh' href='cases/knowledgecheck' data-flinkto='knowledgecheck' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'data-case_name='"+case_name+"' data-case_module_name='"+input_value+"'>"+input_value_substr+"<img src='../assets/images/pen-edit.jpg' onclick='toinput_case_mod(this);'></p></span>");
            }else{
              newUlDIV.append("<span class='module_input disp_in_block flt_left' style='"+prevent_click+"'><input type='text' class='input_module_fld' id='module_inp' placeholder='Add Module Name' onChange='check_value_case_mod(this);' value='"+parseString(input_value)+"'onblur='totext_case_mod(this);' style='display: none;' maxlength='256'  data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'><p id='module_module_"+level_count_inc+"' data-prev_val='"+encodeURIComponent(parseString(input_value))+"' class='main_mod_title navigate_refresh' href='cases/caselistlevel' data-flinkto='caselistlevel' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'>"+input_value_substr+"<img src='../assets/images/pen-edit.jpg' onclick='toinput_case_mod(this);'></p></span>");
            }
            newUlDIV.append("<span class='expand_img_icon  disp_in_block flt_right'><img src='../assets/images/arrow_down_icon.png' class='expand_icon' onclick='toggle_collapse_expand_case_mod(this);'></span>");
              //newUl.append("<li class='dots_img_icon disp_in_block flt_right' style='"+prevent_click+"'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton3' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-ellipsis-v'></i></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton3'><li><a class='dropdown-item' data-flinkto='caselistlevel' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'>Edit</a></li><li><a data-bs-toggle='modal' data-bs-target='#mAlert' data-module_name='"+input_value+"' data-case_id='"+a[i].case_id+"'  data-case_module_id='"+a[i].module_id+"' class='dropdown-item' onClick='delete_case_module_confirm(this)'>Delete</a></li></ul></li>");
              newUlDIV.append("<span class='dots_img_icon disp_in_block flt_right' style='"+prevent_click+"'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton3' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-ellipsis-v'></i></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton3'><span><a data-module_name='"+input_value+"' data-case_id='"+a[i].case_id+"'  data-case_module_id='"+a[i].module_id+"' class='dropdown-item' onClick='delete_case_module_confirm(this)'>Delete</a></span></ul></span>");
              //newUl.append("<li class='progress_btn disp_in_block flt_right' style='"+prevent_click+"'><p class='"+status_class+"'>"+status_text+"</p></li>");
              var preven_click_attachment = prevent_click;
              if(processRights("Add Audio") === false && processRights("Add Slide") === false && processRights("Add Video") === false){
                //preven_click_attachment = "pointer-events:none;";
              }
              if(a[i].attachment_count > 0){
                newUlDIV.append("<span class='attach_img_icon disp_in_block flt_right' style='"+preven_click_attachment+"'><img src='../assets/images/attach-icon.png' class='attach_icon' onclick='show_attachment_popup_case_mod(this)' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'><span class='icon_counts'>"+a[i].attachment_count+"</span></span>");
              }else{
                newUlDIV.append("<span class='attach_img_icon disp_in_block flt_right' style='"+preven_click_attachment+"'><img src='../assets/images/attach-icon.png' class='attach_icon' onclick='show_attachment_popup_case_mod(this)' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'></span>");
              }
              if(a[i].comment_count > 0){
                newUlDIV.append("<span class='message_img_icon disp_in_block flt_right' style='"+prevent_click+"'><img src='../assets/images/message-icon.png' class='message_icon' onclick='show_message_popup_case_mod(this)' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'><span class='icon_counts'>"+a[i].comment_count+"</span></span>");
              }else{
                newUlDIV.append("<span class='message_img_icon disp_in_block flt_right' style='"+prevent_click+"'><img src='../assets/images/message-icon.png' class='message_icon' onclick='show_message_popup_case_mod(this)' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'></span>");
              }
              if(a[i].assign_count > 0){
                newUlDIV.append("<span class='user_img_icon disp_in_block flt_right' style='"+prevent_click+"'><img src='../assets/images/user-icon.png' class='user_icon' onclick='show_assignee_popup_case_mod(this)' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'><span class='icon_counts'>"+a[i].assign_count+"</span></span>");
              }else{
                newUlDIV.append("<span class='user_img_icon disp_in_block flt_right' style='"+prevent_click+"'><img src='../assets/images/user-icon.png' class='user_icon' onclick='show_assignee_popup_case_mod(this)' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'></span>");
              }
              newUlDIV.append("<span class='frame_img_icon disp_in_block flt_right' style='"+prevent_click+"'><img src='../assets/images/frame-icon.png' class='frame_icon' onclick='show_tag_popup_case_mod(this)' data-getresult='tag' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'></span>");
              newUlDIV.append("<span class='plus_img_icon disp_in_block flt_right' style='"+prevent_click+"'><img src='../assets/images/plus-icon.png' class='plus_icon' onClick='add_sub_case_mod(this);'></span>");
              //newUl.append("<li class='plus_img_icon disp_in_block flt_right' style='"+prevent_click+"'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton4' data-bs-toggle='dropdown' aria-expanded='false'><img src='../assets/images/plus-icon.png' class='plus_icon' ></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton4'><li><a data-module_name='"+input_value+"' data-case_id='"+a[i].case_id+"'  data-case_module_id='"+a[i].module_id+"' class='dropdown-item' onClick='add_sub_case_mod(this)'>Add Section / Sub Section</a></li><li><a class='dropdown-item' onClick='add_sub_kc(this)'>Add knowledgecheck</a></li></ul></li>");
            newDIV.append(newUlDIV);
          }else{
                var class_name = $parent.parent().prop('className').split(" ");
                var first_five_char_class = class_name[1].substring(0,5);
                if(first_five_char_class === "modul"){
                  var levels = a[i].level;
                }else{
                  var levels = $parent.parent().attr('id')+"."+a[i].level;
                }
                var n = a[i].module_name.lastIndexOf('/');
                var dots = "";
                if(a[i].module_name.length > 75){
                    dots = "...";
                }
                var input_value_substr = a[i].module_name.substring(0, 75)+dots;
                var input_value = a[i].module_name.substring(n + 1);
                var prevent_click = "";
                if(a[i].can_access == false){
                    prevent_click = "pointer-events:none;";
                }
                var title_font = '';   
                var no_icon = ""; 
                if(String(levels).indexOf('.') !== -1){
                    //do nothing
                    no_icon = "true";
                } else{
                    title_font = 'main_mod_sub_title';
                }
              var lev_mod = level_count_inc - 1;
                if(a[i].is_qa == true){
                    if (a[i].children.length > 0){
                        newDIV = $("<li class='module sub_module_"+levels+" sub_"+levels+" module_"+lev_mod+"  disp_block' id='"+levels+"' style=''></li>");
                    }else{
                        newDIV = $("<li class='module sub_module_"+levels+" sub_"+levels+" module_"+lev_mod+"  disp_block' id='"+levels+"' style=''></li>");
                    }
                }else{
                    if (a[i].children.length > 0){
                        newDIV = $("<li class='module sub_module_"+levels+" sub_"+levels+" module_"+lev_mod+" has_child disp_block' id='"+levels+"' style=''></li>");
                    }else{
                        newDIV = $("<li class='module sub_module_"+levels+" sub_"+levels+" module_"+lev_mod+" no_child disp_block' id='"+levels+"' style=''></li>");
                    }
                }
              newUl = $("<ul class='sub_module'></ul>");
              newUlDIV = $("<div></div>");
              newUlDIV.append("<span class='course_img_icon disp_in_block flt_left' style='"+prevent_click+"'><img src='../assets/images/course-icon.png' class='course_icon'></span>");

                if(a[i].is_qa == true){
                  newUlDIV.append("<span class='course_img_icon disp_in_block flt_left' style='"+prevent_click+"'><img src='../assets/images/pad.jpg' class='expand_icon navigate_refresh' href='cases/knowledgecheck'  data-flinkto='knowledgecheck' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"' data-case_name='"+case_name+"' data-case_module_name='"+input_value+"'></span>");
                  newUlDIV.append("<span class='module_input disp_in_block flt_left' style='"+prevent_click+"'><input type='text' class='input_module_fld' id='module_inp' placeholder='Add Module Name' onChange='check_value_case_mod(this);' value='"+parseString(input_value)+"'onblur='totext_case_mod(this);' style='display: none;' maxlength='256' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'><p id='sub_"+levels+"_module_"+(level_count_inc - 1)+"' data-prev_val='"+encodeURIComponent(parseString(input_value))+"' class='"+title_font+" navigate_refresh' href='cases/knowledgecheck'  data-flinkto='knowledgecheck' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"' data-case_name='"+case_name+"' data-case_module_name='"+input_value+"'>"+input_value_substr+"<img src='../assets/images/pen-edit.jpg' onclick='toinput_case_mod(this);'></p> </span>");
                }else{
                  newUlDIV.append("<span class='module_input disp_in_block flt_left' style='"+prevent_click+"'><input type='text' class='input_module_fld' id='module_inp' placeholder='Add Module Name' onChange='check_value_case_mod(this);' value='"+parseString(input_value)+"'onblur='totext_case_mod(this);' style='display: none;' maxlength='256' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'><p id='sub_"+levels+"_module_"+(level_count_inc - 1)+"' data-prev_val='"+encodeURIComponent(parseString(input_value))+"' class='"+title_font+" navigate_refresh' href='cases/caselistlevel' data-flinkto='caselistlevel' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'>"+input_value_substr+"<img src='../assets/images/pen-edit.jpg' onclick='toinput_case_mod(this);'></p> </span>");
                }
              if(a[i].is_qa == false){
                  newUlDIV.append("<span class='expand_img_icon disp_in_block flt_right'><img src='../assets/images/arrow_down_icon.png' class='expand_icon' onclick='toggle_collapse_expand_case_mod(this);'></span>");

                  //newUl.append("<li class='dots_img_icon disp_in_block flt_right' style='"+prevent_click+"'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton3' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-ellipsis-v'></i></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton3'><li><a class='dropdown-item' data-flinkto='caselistlevel' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'>Edit</a></li><li><a data-bs-toggle='modal' data-bs-target='#mAlert' data-module_name='"+input_value+"' data-case_id='"+a[i].case_id+"'  data-case_module_id='"+a[i].module_id+"' class='dropdown-item' onClick='delete_case_module_confirm(this)'>Delete</a></li></ul></li>");
                  newUlDIV.append("<span class='dots_img_icon disp_in_block flt_right' style='"+prevent_click+"'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton3' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-ellipsis-v'></i></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton3'><span><a data-module_name='"+input_value+"' data-case_id='"+a[i].case_id+"'  data-case_module_id='"+a[i].module_id+"' class='dropdown-item' onClick='delete_case_module_confirm(this)'>Delete</a></span></ul></span>");
                  //newUl.append("<li class='progress_btn disp_in_block flt_right' style='"+prevent_click+"'><p class='"+status_class+"'>"+status_text+"</p></li>");
                  var preven_click_attachment = prevent_click;
                  if(processRights("Add Audio") === false && processRights("Add Slide") === false && processRights("Add Video") === false){
                    //preven_click_attachment = "pointer-events:none;";
                  }
                  if(a[i].attachment_count > 0){
                    newUlDIV.append("<span class='attach_img_icon disp_in_block flt_right' style='"+preven_click_attachment+"'><img src='../assets/images/attach-icon.png' class='attach_icon' onclick='show_attachment_popup_case_mod(this)' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'><span class='icon_counts'>"+a[i].attachment_count+"</span></span>");
                  }else{
                    newUlDIV.append("<span class='attach_img_icon disp_in_block flt_right' style='"+preven_click_attachment+"'><img src='../assets/images/attach-icon.png' class='attach_icon' onclick='show_attachment_popup_case_mod(this)' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'></span>");
                  }
                  if(a[i].comment_count > 0){
                    newUlDIV.append("<span class='message_img_icon disp_in_block flt_right' style='"+prevent_click+"'><img src='../assets/images/message-icon.png' class='message_icon' onclick='show_message_popup_case_mod(this)' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'><span class='icon_counts'>"+a[i].comment_count+"</span></span>");
                  }else{
                    newUlDIV.append("<span class='message_img_icon disp_in_block flt_right' style='"+prevent_click+"'><img src='../assets/images/message-icon.png' class='message_icon' onclick='show_message_popup_case_mod(this)' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'></span>");
                  }
                  if(a[i].assign_count > 0){
                    newUlDIV.append("<span class='user_img_icon disp_in_block flt_right' style='"+prevent_click+"'><img src='../assets/images/user-icon.png' class='user_icon' onclick='show_assignee_popup_case_mod(this)' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'><span class='icon_counts'>"+a[i].assign_count+"</span></span>");
                  }else{
                    newUlDIV.append("<span class='user_img_icon disp_in_block flt_right' style='"+prevent_click+"'><img src='../assets/images/user-icon.png' class='user_icon' onclick='show_assignee_popup_case_mod(this)' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'></span>");
                  }
                  newUlDIV.append("<span class='frame_img_icon disp_in_block flt_right' style='"+prevent_click+"'><img src='../assets/images/frame-icon.png' class='frame_icon' onclick='show_tag_popup_case_mod(this)' data-getresult='tag' data-case_module_id='"+a[i].module_id+"' data-case_id='"+a[i].case_id+"'></span>");
                  newUlDIV.append("<span class='plus_img_icon disp_in_block flt_right' style='"+prevent_click+"'><img src='../assets/images/plus-icon.png' class='plus_icon' onClick='add_sub_sub_case_mod(this);'></span>");
                  
              //newUl.append("<li class='plus_img_icon disp_in_block flt_right' style='"+prevent_click+"'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton4' data-bs-toggle='dropdown' aria-expanded='false'><img src='../assets/images/plus-icon.png' class='plus_icon' ></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton4'><li><a data-module_name='"+input_value+"' data-case_id='"+a[i].case_id+"'  data-case_module_id='"+a[i].module_id+"' class='dropdown-item' onClick='add_sub_case_mod(this)'>Add Section / Sub Section</a></li><li><a class='dropdown-item' onClick='add_sub_kc(this)'>Add knowledgecheck</a></li></ul></li>");
            }
            newDIV.append(newUlDIV);

          }
          if(level_count === 0){  
            newDIV.append(newUl);
            $parent.append(newDIV);

            //level_count_inc++;
          }else{
            newDIV.append(newUl);
            $parent.append(newDIV);
          }
          if(a[i].parent_id === null){
            level_count_inc++;
          }
          if (a[i].children){
              get_list_mod( a[i].children, newUl, level_count_inc, case_name);
          }
      }
    $parent.append(newDIV);
  }
}
/***************Case Modules Get Json and assign Tree structured format and Design Ends Here*************/

/******* Expand and collapse main and sub module Levels Starts **************/
function toggle_collapse_expand_case_mod(e){
    var childrendivs = [];
    var children = e.parentElement.parentElement.nextElementSibling.children;
    var action = e.innerHTML;
    for(var i = 0; i < children.length; i++){
        if (children[i].tagName == "LI") {
          if(children[i].classList.contains('disp_none')){
              e.src="../assets/images/arrow_down_icon.png";
              children[i].classList.add('disp_block');
              children[i].classList.remove('disp_none');
              childrendivs.push(children[i]);
          }else{
              e.src="../assets/images/arrow_up_icon.png";
              children[i].classList.add('disp_none');
              children[i].classList.remove('disp_block');
              childrendivs.push(children[i]);
          }
        }
    }
}
function show_tag_popup_case_mod(e){
  //var offsets = e.getBoundingClientRect();
  //var offset_box = document.getElementById("course_box").getBoundingClientRect();
  //var top = offsets.top + Math.max( $("html").scrollTop(), $("body").scrollTop() ) - 70;
  //var right = offset_box.left;
  if(e.dataset.case_id && e.dataset.case_module_id){
      const container = document.getElementById("popup_course_icon");
      const modal = new bootstrap.Modal(container, { backdrop: true, keyboard: true });
      //document.getElementById("content-courseModule").style.transform = "translate(0px, "+top+"px)";
      var url = `${SITE_URL_PROTOCOL}/assets/pages/cases/case_tag.html?t=` + Math.floor(Date.now() / 1000);
      $('.modal-content').load(url,function(result){
        $("#content-courseModule").attr("style", "height:200px;top:250px;");
        document.getElementById("case_param").setAttribute("data-case_module_id", e.dataset.case_module_id);
        document.getElementById("case_param").setAttribute("data-case_id", e.dataset.case_id);
        modal.toggle();
      });
  }
}

function show_attachment_popup_case_mod(e){
  //var right = offset_box.left;
  if(e.dataset.case_id && e.dataset.case_module_id){
      const container = document.getElementById("popup_course_icon");
      const modal = new bootstrap.Modal(container, { backdrop: true, keyboard: true });
      var url = `${SITE_URL_PROTOCOL}/assets/pages/cases/attachment_popup.html?t=` + Math.floor(Date.now() / 1000);
      $('.modal-content').load(url,function(result){
        $("#content-courseModule").attr("style", "height:680px;top:25px;");
        document.getElementById("case_param").setAttribute("data-case_module_id", e.dataset.case_module_id);
        document.getElementById("case_param").setAttribute("data-case_id", e.dataset.case_id);
        modal.toggle();
      });
  }
}
function show_message_popup_case_mod(e){
  //var right = offset_box.left;
  if(e.dataset.case_id && e.dataset.case_module_id){
      const container = document.getElementById("popup_course_icon");
      const modal = new bootstrap.Modal(container, { backdrop: true, keyboard: true });
      var url = `${SITE_URL_PROTOCOL}/assets/pages/cases/message_popup.html?t=` + Math.floor(Date.now() / 1000);
      $('.modal-content').load(url,function(result){
        $("#content-courseModule").attr("style", "height:500px;top:100px;");
        document.getElementById("case_param").setAttribute("data-case_module_id", e.dataset.case_module_id);
        document.getElementById("case_param").setAttribute("data-case_id", e.dataset.case_id);
        modal.toggle();
      });
  }
}
function show_assignee_popup_case_mod(e){
  //var right = offset_box.left;
  if(e.dataset.case_id && e.dataset.case_module_id){
      const container = document.getElementById("popup_course_icon");
      const modal = new bootstrap.Modal(container, { backdrop: true, keyboard: true });
      var url = `${SITE_URL_PROTOCOL}/assets/pages/cases/assignee_popup.html?t=` + Math.floor(Date.now() / 1000);
      $('.modal-content').load(url,function(result){
        $("#content-courseModule").attr("style", "height:500px;top:100px;");
        document.getElementById("case_param").setAttribute("data-case_module_id", e.dataset.case_module_id);
        document.getElementById("case_param").setAttribute("data-case_id", e.dataset.case_id);
        modal.toggle();
      });
  }
}

//$(document).ready(function(){
  $('#popup_course_icon').on('hidden.bs.modal', function () {
    //setTimeout(function(){
      //$('#case_id_mod').trigger('click');
      location.reload();
  //  }, 0);
  });
  //});
function toinput_case_mod(e){
    if(e.tagName == "P"){
        e.setAttribute("style","display:none");
        e.previousSibling.setAttribute("style","display:block");
        e.previousSibling.focus();
    }else{
        e.parentElement.setAttribute("style", "display:none");
        e.parentElement.previousSibling.setAttribute("style","display:block");
        e.parentElement.previousSibling.focus();
    }
}
function totext_case_mod(e){
    if(e.value == ''){
        e.value = e.nextSibling.dataset.prev_val;
    }
    if(e.value != "" && e.value != "Add Module Name"){
      var class_module_level = e.parentElement.parentElement.parentElement.classList[1];
      var first_five_char_class = class_module_level.substring(0,5);
      var get_submodule_level_values = '';
      if(e.dataset.case_module_id){
        var url = API_CONTENT_URL + '/case_modules/'+e.dataset.case_module_id+'/';
        var method = "PUT";
      }else{
        var url = API_CONTENT_URL + '/case_modules/';
        var method = "POST";
      }
      if(first_five_char_class === "modul"){
        var level_number = class_module_level.split('_')[1];
        var get_submodule_level_values = {
          module_name: String(e.value),
          level: parseInt(level_number), 
          case_id:String(document.getElementById("case_id_name").getAttribute("data-case_id")),
          parent_id:null
        }
      }else if(first_five_char_class === "sub_m"){
        var class_module_main_level = e.parentElement.parentElement.parentElement.classList[3];
        var class_module_sub_level = e.parentElement.parentElement.parentElement.classList[2];
        var parent_id = e.parentElement.parentElement.parentElement.parentElement.parentElement.children[0].children[1].children[0].getAttribute("data-case_module_id");
        get_submodule_level_values = get_submodule_level_val_case_mod(class_module_main_level, class_module_sub_level, e.value, parent_id);
      }

      e.nextSibling.dataset.prev_val = e.value;
      if(get_submodule_level_values != ''){
        var message = "";
        post_json_dat_case_mod(url, get_submodule_level_values, method, e, message);
      }
      let case_id = e.dataset.case_id;
      let module_id_val = e.dataset.case_module_id;
      const mytagArray = e.value.split(" ");
      if(case_id && module_id_val){
        var prev_tags = get_module_details_case_mod(case_id, module_id_val, mytagArray);
      }
      
    }
    var childList = e.parentElement.parentElement.childNodes
    childList.forEach(function(item){
        item.setAttribute("style","pointer-events:unset;");
    })
    if(e.nextElementSibling.childNodes[1] && e.nextElementSibling.childNodes[1].tagName == "IMG"){
        var dots = "";
        if(e.value.length > 75){
            dots = "...";
        }
        var input_value_substr = e.value.substring(0, 75)+dots;
        e.nextSibling.innerHTML = input_value_substr +`<img src="../assets/images/pen-edit.jpg" onclick="toinput_case_mod(this);">`;
        e.setAttribute("style","display:none");
        e.nextSibling.setAttribute("style","display:block");
        e.nextElementSibling.classList.remove("navigate_refresh");
        e.nextElementSibling.classList.add("navigate_refresh");
        e.nextSibling.focus();
    }else{
        var dots = "";
        if(e.value.length > 75){
            dots = "...";
        }
        var input_value_substr = e.value.substring(0, 75)+dots;
        e.nextSibling.innerHTML = input_value_substr;
        e.setAttribute("style","display:none");
        e.nextSibling.setAttribute("style","display:block");
        e.nextElementSibling.classList.remove("navigate_refresh");
        e.nextElementSibling.classList.add("navigate_refresh");
        e.nextSibling.focus();
    }

}

function get_module_details_case_mod(case_id, module_id, mytagArray){
  $.ajax({
    url: API_CONTENT_URL + '/case_tags/?case_id='+case_id+'&case_module_id='+module_id,
    type: 'get',
    dataType: 'json',
    headers: {
      "Authorization": "Bearer " + getUserInfo().access_token,
      "Content-Type": "application/json"
    },
    success:function(response){
      var tags_response = "";
        mytagArray.forEach(function (element, index) {
        tag_exists = response.some(function(o){return o["name"] === element;})
        if(!tag_exists){
          var tag_data = {
              "name": element,
              "case_module_id": module_id,
              "case_id": case_id
          }
          $.ajax({
            url: API_CONTENT_URL + '/case_tags/?case_id='+case_id+'&case_module_id='+module_id,
            type: 'POST',
            data: JSON.stringify(tag_data),
            headers: { "Content-type": "application/json; charset=UTF-8", "Authorization": "Bearer " + getUserInfo().access_token },
            success:function(response){
            },
            error: function(error) {
              tags_response = "1";
              toastr.error("Response Error: " + error.message);
              console.log(error);
            }
          });
        }
      });
    }
  });
}
function get_submodule_level_val_case_mod(class_module_main_level, class_module_sub_level, ele_val, parent_id_val){
  var data_course_module = "";
  if(class_module_sub_level.indexOf('.') !== -1){
      var level_number = (class_module_sub_level.split("_module")[0]).split(".")[class_module_sub_level.split(".").length-1];
      data_course_module = {
        module_name: String(ele_val),
        level: parseInt(level_number), 
        case_id:String(document.getElementById("case_id_name").getAttribute("data-case_id")),
        parent_id: parent_id_val
      }

  }else{
      var level_number = class_module_sub_level.split('_')[1];
      data_course_module = {
        module_name: String(ele_val),
        level: parseInt(level_number), 
        case_id:String(document.getElementById("case_id_name").getAttribute("data-case_id")),
        parent_id: parent_id_val
      }
  }
  return data_course_module;
}

function post_json_dat_case_mod(url, data, call_method, e, message){
  fetch(url, {
    method: call_method,
    body: JSON.stringify(data),
    headers: {"Content-type": "application/json; charset=UTF-8", "Authorization": "Bearer " + getUserInfo().access_token},
  })
  .then((response) => response.json())
  .then((json) => {
    var module_name = "";
    //el_1 = e.parentElement.parentElement.childNodes[3].childNodes[1].firstChild.firstChild;//edit
    //el_2 = e.parentElement.parentElement.childNodes[3].childNodes[1].childNodes[1].firstChild;//delete
    if(e.parentElement.parentElement.childNodes.length > 3){
      el_1 = e.parentElement.parentElement.childNodes[1].childNodes[1];//edit
      el_2 = e.parentElement.parentElement.childNodes[3].childNodes[1].firstChild.firstChild;//delete
      el_3 = e.parentElement.parentElement.childNodes[8].firstChild;//tags
      //el_4 = e.parentElement.parentElement.childNodes[4].firstChild;//progress
      el_5 = e.parentElement.parentElement.childNodes[4].firstChild;//attachment
      el_6 = e.parentElement.parentElement.childNodes[4].firstChild;//comment
      el_7 = e.parentElement.parentElement.childNodes[6].firstChild;//assign
    }else{
      el_1 = e.parentElement.parentElement.childNodes[2].childNodes[1];//edit
    }
    el_li_0 = e.parentElement.parentElement.childNodes[0];//Drag & Drop
    if(e.parentElement.parentElement.childNodes.length > 3){
      el_li_1 = e.parentElement.parentElement.childNodes[1];//Input
      el_li_2 = e.parentElement.parentElement.childNodes[2];//Expand Or Collapse
      el_li_3 = e.parentElement.parentElement.childNodes[3];//Three Dots
      el_li_4 = e.parentElement.parentElement.childNodes[4];//Attachment
      el_li_5 = e.parentElement.parentElement.childNodes[5];//Message
      el_li_6 = e.parentElement.parentElement.childNodes[6];//Assignee
      el_li_7 = e.parentElement.parentElement.childNodes[7];//Add module
      el_li_8 = e.parentElement.parentElement.childNodes[8];//Tag
    }else{
      el_li_1 = e.parentElement.parentElement.childNodes[2];//Input
    }
    //el_li_9 = e.parentElement.parentElement.childNodes[9];
    el_1.setAttribute("data-flinkto", "caselistlevel");
    el_1.setAttribute("href", "cases/caselistlevel");
    if(json.module_id != undefined || json.module_id != null){
      e.setAttribute("data-case_module_id", json.module_id);
      el_1.setAttribute("data-case_module_id", json.module_id);

      if(e.parentElement.parentElement.childNodes.length > 3){
        el_2.setAttribute("data-case_module_id", json.module_id);
        el_3.setAttribute("data-case_module_id", json.module_id);
        //el_4.setAttribute("data-case_module_id", json.module_id);
        el_5.setAttribute("data-case_module_id", json.module_id);
        el_6.setAttribute("data-case_module_id", json.module_id);
        el_7.setAttribute("data-case_module_id", json.module_id);
      }
    }
    if(json.case_id != undefined || json.case_id != null){
      e.setAttribute("data-case_id", json.case_id);
      el_1.setAttribute("data-case_id", json.case_id);

      if(e.parentElement.parentElement.childNodes.length > 3){
        el_2.setAttribute("data-case_id", json.case_id);
        el_3.setAttribute("data-case_id", json.case_id);
        //el_4.setAttribute("data-case_id", json.case_id);
        el_5.setAttribute("data-case_id", json.case_id);
        el_6.setAttribute("data-case_id", json.case_id);
        el_7.setAttribute("data-case_id", json.case_id);
      }
    }
    if(json.can_access == false){
      el_li_0.style.cssText = "pointer-events: none";
      el_li_1.style.cssText = "pointer-events: none";
      if(e.parentElement.parentElement.childNodes.length > 3){
        el_li_2.style.cssText = "pointer-events: none";
        el_li_3.style.cssText = "pointer-events: none";
        el_li_4.style.cssText = "pointer-events: none";
        el_li_5.style.cssText = "pointer-events: none";
        el_li_6.style.cssText = "pointer-events: none";
        el_li_7.style.cssText = "pointer-events: none";
        el_li_8.style.cssText = "pointer-events: none";
        //el_li_9.style.cssText = "pointer-events: none";
      }
    }
    if(json.module_name != undefined || json.module_name != null){
      if(e.parentElement.parentElement.childNodes.length > 3){
        el_2.setAttribute("data-module_name", json.module_name);
        module_name = json.module_name;
      }
    }
    var classList = e.parentElement.parentElement.parentElement.className.split(/\s+/);
    var num = "";
    if(classList[2] == 'main_mod'){
      num = 0;
    }else{
      var index = classList[1].lastIndexOf("_");
      var res_1 = Number(classList[1].substr(index+1));
      console.log(e.parentElement.parentElement.getElementsByTagName("LI").length);
      var result = classList[1].substr(index+1)+"."+ Number(e.parentElement.parentElement.childNodes.length - 8);
      num = String(result).match(/\./g).length;
    }
    var result_textMsg = "";
    if(num === 0){
      result_textMsg = "Module:";
    }else if(num === 1){
      result_textMsg = "Chapter:";
    }else if(num === 2){
      result_textMsg = "Lesson:";
    }else if(num === 3){
      result_textMsg = "Topic:";
    }else if (num === 4){
      result_textMsg = "Sub Topic:";
    }else if (num > 4){
      result_textMsg = "Level:";
    }
    result_textMsg = "Level:"
    if(call_method == "POST"){
      toastr.success("Created Successfully.");
    }else{
      toastr.success("Updated Successfully.");
    }
  })
  .catch(function (error) {
    console.log("Requestfailed", error);
  });
}
function check_value_case_mod(e){
    console.log(e);
    var x = e.parentElement.parentElement.parentElement.lastElementChild.childNodes;
    if(e.value != ''){
        e.parentElement.parentElement.setAttribute("style","opacity:1");
        var classList = e.parentElement.parentElement.parentElement.className.split(/\s+/);
        var index = classList[1].lastIndexOf("_");
        if(classList[2] == 'main_mod_empty'){
            e.parentElement.parentElement.parentElement.classList.remove('main_mod_empty');
            e.parentElement.parentElement.parentElement.classList.remove('mjs-nestedSortable-leaf');
            e.parentElement.parentElement.parentElement.classList.remove('no_child');
            e.parentElement.parentElement.parentElement.classList.add('main_mod');
            e.parentElement.parentElement.parentElement.classList.add('no_child');
            e.parentElement.parentElement.parentElement.classList.add('mjs-nestedSortable-leaf');
            //e.parentElement.parentElement.parentElement.classList.add('draggable');
            e.parentElement.parentElement.parentElement.setAttribute("style","opacity:1");
            if(e.parentElement.previousSibling.nodeName == "#text"){
                //e.parentElement.parentElement.childNodes[1].firstChild.setAttribute('draggable','true');
            }else{
                //e.parentElement.previousSibling.firstChild.setAttribute("draggable","true");
            }
        }
        var result = Number(classList[1].substr(index+1)) + Number(1);
    }else{
        e.parentElement.parentElement.parentElement.classList.remove('main_mod');
        e.parentElement.parentElement.parentElement.classList.add('main_mod_empty');
        //e.parentElement.parentElement.parentElement.classList.remove('draggable');
        e.parentElement.parentElement.setAttribute("style","opacity:0.5");
        if(e.parentElement.previousSibling.firstChild !== null){
          //e.parentElement.previousSibling.firstChild.setAttribute("draggable","true");
        }
    }
    /*var listItens = document.querySelectorAll('.draggable');
    [].forEach.call(listItens, function(item) {
      addEventsDragAndDrop(item);
    });*/

}
function add_sub_case_mod(e){
    var x =e.parentElement.parentElement.childNodes;
    console.log(x);
    if(x[0].nodeName == "#text"){
        var inp_val = x[3].childNodes[1].innerHTML;
    }else{
        var inp_val = x[1].childNodes[1].innerHTML;
    }
    if(inp_val != ''){
        var classList = e.parentElement.parentElement.parentElement.className.split(/\s+/);
        if(classList[2] == 'main_mod'){
            if(e.parentElement.parentElement.parentElement.parentElement.childNodes[e.parentElement.parentElement.parentElement.parentElement.childNodes.length-1].classList !== undefined && e.parentElement.parentElement.parentElement.parentElement.childNodes[e.parentElement.parentElement.parentElement.parentElement.childNodes.length-1].classList[2] == 'main_mod_empty'){
              var main_mod_level = e.parentElement.parentElement.parentElement.classList[1];
                var index = classList[1].lastIndexOf("_");

                //var result = e.children[1].children.length+1;
                if(e.parentElement.parentElement.childNodes[0].nodeName == '#text'){
                    var result = Number(e.parentElement.parentElement.childNodes.length)- Number(18);
                }else{
                    var result = Number(e.parentElement.parentElement.childNodes.length)- Number(8);
                }
                if(e.parentElement.parentElement.nextElementSibling){
                  var result = e.parentElement.parentElement.nextElementSibling.children.length+1;
                }else{
                  var result = 1;
                }
                newHTML = "<li class='module sub_module_"+result+" sub_"+result+" "+main_mod_level+" no_child'>";
                newHTML += "<div>";
                newHTML += "<span class='course_img_icon disp_in_block flt_left' style='pointer-events:none;'><img src='../assets/images/course-icon.png' class='course_icon'></span>";
                newHTML += "<span class='module_input disp_in_block flt_left'><input type='text' class='input_module_fld' id='module_inp' placeholder='Add Module Name' onChange='check_value_case_mod(this);' value='Level "+result+"'onblur='totext_case_mod(this);' style='display: none;' maxlength='256'><p id='sub_"+result+"_"+main_mod_level+"' data-prev_val='Level "+result+"' data-case_id=''  data-case_module_id=''>Level "+result+" <img src='../assets/images/pen-edit.jpg' onclick='toinput_case_mod(this);'></p></span>";
                newHTML += "<span class='expand_img_icon disp_in_block flt_right'><img src='../assets/images/arrow_up_icon.png' class='expand_icon' onclick='toggle_collapse_expand_case_mod(this);'></span>";
                //newHTML += "<li class='dots_img_icon disp_in_block flt_right' style='pointer-events:none;'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton3' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-ellipsis-v'></i></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton3'><li><a class='dropdown-item' data-case_id=''  data-case_module_id=''>Edit</a></li><li><a data-bs-toggle='modal' data-bs-target='#mAlert' class='dropdown-item' data-module_name='' data-case_id='' data-case_module_id='' onClick='delete_case_module_confirm(this)'>Delete</a></li></ul></li>";
                newHTML += "<span class='dots_img_icon disp_in_block flt_right' style='pointer-events:none;'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton3' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-ellipsis-v'></i></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton3'><span><a class='dropdown-item' data-module_name='' data-case_id='' data-case_module_id='' onClick='delete_case_module_confirm(this)'>Delete</a></span></ul></span>";
                //newHTML += "<li class='progress_btn disp_in_block flt_right'><p class='status_new'>New</p></li>";
                newHTML += "<span class='attach_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/attach-icon.png' class='attach_icon' onClick='show_attachment_popup_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                newHTML += "<span class='message_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/message-icon.png' class='message_icon' onClick='show_message_popup_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                newHTML += "<span class='user_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/user-icon.png' class='user_icon' onClick='show_assignee_popup_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                newHTML += "<span class='frame_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/frame-icon.png' class='frame_icon' onclick='show_tag_popup_case_mod(this)' data-getresult='tag' data-case_id='' data-case_module_id=''></span>";
                newHTML += "<span class='plus_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/plus-icon.png' class='plus_icon' onClick='add_sub_sub_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                newHTML += "</div>";
                newHTML += "</li>";
                $(e).closest('.main_mod').removeClass("no_child");
                $(e).closest('.main_mod').addClass("has_child");
                if(e.parentElement.parentElement.nextElementSibling){
                  e.parentElement.parentElement.nextElementSibling.insertAdjacentHTML('beforeend', newHTML);
                }else{
                  e.parentElement.parentElement.parentElement.insertAdjacentHTML('beforeend', "<ul class='sub_module'></ul>");
                  e.parentElement.parentElement.nextElementSibling.insertAdjacentHTML('beforeend', newHTML);
                }

                var class_module_main_level = main_mod_level;
                var class_module_sub_level = "sub_"+result;
                var input_val = "Level "+result;
                //toastr.success("Chapter Added.");
                return;
            }
            if((e.parentElement.parentElement.parentElement.childNodes[0].nodeName == '#text' && e.parentElement.parentElement.parentElement.childNodes.length == 3) ||  (e.parentElement.parentElement.parentElement.childNodes[0].nodeName != '#text' && e.parentElement.parentElement.parentElement.childNodes.length == 1)){
                var index = classList[1].lastIndexOf("_");
                //var result = Number(classList[1].substr(index+1));
                //var result = Number(e.parentElement.parentElement.parentElement.parentElement.childNodes.length) + Number(1);
                var result = e.parentElement.parentElement.parentElement.parentElement.children.length+1;
                newHTML = "<li class='module module_"+result+" main_mod_empty no_child' style='opacity:0.5;'>";
                newHTML += "<div>";
                newHTML += "<span class='course_img_icon disp_in_block flt_left' style='pointer-events:none;'><img src='../assets/images/course-icon.png' class='course_icon'></span>";
                newHTML += "<span class='module_input disp_in_block flt_left'><input type='text' class='input_module_fld' id='module_inp' placeholder='Add Module Name' onChange='check_value_case_mod(this);' value=''onblur='totext_case_mod(this);' style='display: none;' maxlength='256'><p id='module_module_"+result+"' data-prev_val='Add Module Name' data-case_id='' data-case_module_id=''>Add Module Name <img src='../assets/images/pen-edit.jpg' onclick='toinput_case_mod(this);'></p></span>";
                newHTML += "<span class='expand_img_icon disp_in_block flt_right'><img src='../assets/images/arrow_up_icon.png' class='expand_icon' onclick='toggle_collapse_expand_case_mod(this);'></span>";
                //newHTML += "<li class='dots_img_icon disp_in_block flt_right' style='pointer-events:none;'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton3' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-ellipsis-v'></i></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton3'><li><a class='dropdown-item' data-case_id=''  data-case_module_id=''>Edit</a></li><li><a data-bs-toggle='modal' data-bs-target='#mAlert' data-module_name='' data-case_id=''  data-case_module_id='' class='dropdown-item' onClick='delete_case_module_confirm(this)'>Delete</a></li></ul></li>";
                newHTML += "<span class='dots_img_icon disp_in_block flt_right' style='pointer-events:none;'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton3' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-ellipsis-v'></i></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton3'><span><a data-module_name='' data-case_id=''  data-case_module_id='' class='dropdown-item' onClick='delete_case_module_confirm(this)'>Delete</a></span></ul></span>";
                //newHTML += "<li class='progress_btn disp_in_block flt_right'><p class='status_new'>New</p></li>";
                newHTML += "<span class='attach_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/attach-icon.png' class='attach_icon' onClick='show_attachment_popup_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                newHTML += "<span class='message_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/message-icon.png' class='message_icon' onClick='show_message_popup_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                newHTML += "<span class='user_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/user-icon.png' class='user_icon' onClick='show_assignee_popup_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                newHTML += "<span class='frame_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/frame-icon.png' class='frame_icon' onclick='show_tag_popup_case_mod(this)' data-getresult='tag' data-case_id='' data-case_module_id=''></span>";
                newHTML += "<span class='plus_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/plus-icon.png' class='plus_icon' onClick='add_sub_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                newHTML += "</div>";
                newHTML += "</li>";
                e.parentElement.parentElement.parentElement.parentElement.insertAdjacentHTML('beforeend', newHTML);
            }else{
              var index = classList[1].lastIndexOf("_");
                var result = Number(classList[1].substr(index+1));
                var result = Number(e.parentElement.parentElement.parentElement.parentElement.childNodes.length) + Number(1);
                var result = e.parentElement.parentElement.parentElement.parentElement.children.length+1;
                newHTML = "<li class='module module_"+result+" main_mod_empty no_child' style='opacity:0.5;'>";
                newHTML += "<div>";
                newHTML += "<span class='course_img_icon disp_in_block flt_left' style='pointer-events:none;'><img src='../assets/images/course-icon.png' class='course_icon'></span>";
                newHTML += "<span class='module_input disp_in_block flt_left'><input type='text' class='input_module_fld' id='module_inp' placeholder='Add Module Name' onChange='check_value_case_mod(this);' value=''onblur='totext_case_mod(this);' style='display: none;' maxlength='256'><p id='module_module_"+result+"' data-prev_val='Add Module Name' data-case_id='' data-case_module_id=''>Add Module Name <img src='../assets/images/pen-edit.jpg' onclick='toinput_case_mod(this);'></p></span>";
                newHTML += "<span class='expand_img_icon disp_in_block flt_right'><img src='../assets/images/arrow_up_icon.png' class='expand_icon' onclick='toggle_collapse_expand_case_mod(this);'></span>";
                //newHTML += "<li class='dots_img_icon disp_in_block flt_right' style='pointer-events:none;'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton3' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-ellipsis-v'></i></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton3'><li><a class='dropdown-item' data-case_id=''  data-case_module_id=''>Edit</a></li><li><a data-bs-toggle='modal' data-bs-target='#mAlert' data-module_name='' data-case_id=''  data-case_module_id='' class='dropdown-item' onClick='delete_case_module_confirm(this)'>Delete</a></li></ul></li>";
                newHTML += "<span class='dots_img_icon disp_in_block flt_right' style='pointer-events:none;'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton3' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-ellipsis-v'></i></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton3'><span><a data-module_name='' data-case_id=''  data-case_module_id='' class='dropdown-item' onClick='delete_case_module_confirm(this)'>Delete</a></span></ul></span>";
                //newHTML += "<li class='progress_btn disp_in_block flt_right'><p class='status_new'>New</p></li>";
                newHTML += "<span class='attach_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/attach-icon.png' class='attach_icon' onClick='show_attachment_popup_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                newHTML += "<span class='message_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/message-icon.png' class='message_icon' onClick='show_message_popup_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                newHTML += "<span class='user_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/user-icon.png' class='user_icon' onClick='show_assignee_popup_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                newHTML += "<span class='frame_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/frame-icon.png' class='frame_icon' onclick='show_tag_popup_case_mod(this)' data-getresult='tag' data-case_id='' data-case_module_id=''></span>";
                newHTML += "<span class='plus_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/plus-icon.png' class='plus_icon' onClick='add_sub_case_mod(this);' data-case_id='' data-case_module_id=''></span>";
                newHTML += "</div>";
                newHTML += "</li>";
                console.log("empty_mod");
                e.parentElement.parentElement.parentElement.parentElement.insertAdjacentHTML('beforeend', newHTML);
            }
        }
    }
}

function add_sub_sub_case_mod(e){
  var x =e.parentElement.parentElement.childNodes;
  if(x.length == 17){
    var inp_val = x[5].childNodes[0].value;
  }
  if(x.length == 10){
    var inp_val = x[2].childNodes[0].value;
  }
  if(inp_val != ''){
    var main_mod_level = e.parentElement.parentElement.parentElement.classList[3];
    var classList = e.parentElement.parentElement.parentElement.className.split(/\s+/);
    var index = classList[1].lastIndexOf("_");
    var res_1 = Number(classList[1].substr(index+1));
    //var result = e.children[1].children.length+1;
    if(e.parentElement.parentElement.nextElementSibling){
      var result = classList[1].substr(index+1)+"."+ Number(e.parentElement.parentElement.nextElementSibling.children.length+1);
    }else{
      var result = classList[1].substr(index+1)+"."+Number(1);
    }
    var num = String(result).match(/\./g).length;
    var result_text = "";
    var result_textMsg = "";
    if(num === 1){
      result_text = Number(e.parentElement.parentElement.childNodes.length - 8)+". Lesson";
      result_textMsg = "Lesson";
    }else if(num === 2){
      result_text = Number(e.parentElement.parentElement.childNodes.length - 8)+". Topic";
      result_textMsg = "Topic";
    }else if(num === 3){
      result_text = Number(e.parentElement.parentElement.childNodes.length - 8)+". Sub Topic";
      result_textMsg = "Sub Topic";
    }else{
      result_text = "Level "+result;
      result_textMsg = "Level";
    }
      result_text = "Level "+result;
      result_textMsg = "Level";

    newHTML = "<li class='module sub_module_"+result+" sub_"+result+" "+main_mod_level+" no_child'>";
    newHTML += "<div class='sub_module'>";
    newHTML += "<span class='course_img_icon disp_in_block flt_left' style='pointer-events:none;'><img src='../assets/images/course-icon.png' class='course_icon'></span>";
    newHTML += "<span class='module_input disp_in_block flt_left'><input type='text' class='input_module_fld' id='module_inp' placeholder='Add Module Name' onChange='check_value_case_mod(this);' value='Level "+result+"'onblur='totext_case_mod(this);' style='display: none;' maxlength='256'><p id='sub_"+result+"_"+main_mod_level+"' data-prev_val='"+result_text+"'>"+result_text+" <img src='../assets/images/pen-edit.jpg' onclick='toinput_case_mod(this);'></p></span>";
    newHTML += "<span class='expand_img_icon disp_in_block flt_right'><img src='../assets/images/arrow_up_icon.png' class='expand_icon' onclick='toggle_collapse_expand_case_mod(this);'></span>";
    //newHTML += "<li class='dots_img_icon disp_in_block flt_right' style='pointer-events:none;'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton3' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-ellipsis-v'></i></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton3'><li><a class='dropdown-item'>Edit</a></li><li><a data-bs-toggle='modal' data-bs-target='#mAlert' class='dropdown-item' data-module_name='' data-case_id=''  data-case_module_id='' onClick='delete_case_module_confirm(this)'>Delete</a></li></ul></li>";
    newHTML += "<span class='dots_img_icon disp_in_block flt_right' style='pointer-events:none;'><button class='btn dropdown-toggle dbtn' type='button' id='dropdownMenuButton3' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-ellipsis-v'></i></button><ul class='dropdown-menu' aria-labelledby='dropdownMenuButton3'><span><a class='dropdown-item' data-module_name='' data-case_id=''  data-case_module_id='' onClick='delete_case_module_confirm(this)'>Delete</a></span></ul></span>";
    //newHTML += "<li class='progress_btn disp_in_block flt_right'><p class='status_new'>New</p></li>";
    newHTML += "<span class='attach_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/attach-icon.png' class='attach_icon'></span>";
    newHTML += "<span class='message_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/message-icon.png' class='message_icon'></span>";
    newHTML += "<span class='user_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/user-icon.png' class='user_icon'></span>";
    newHTML += "<span class='frame_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/frame-icon.png' class='frame_icon' onclick='show_tag_popup_case_mod(this)' data-getresult='tag'></span>";
    newHTML += "<span class='plus_img_icon disp_in_block flt_right' style='pointer-events:none;'><img src='../assets/images/plus-icon.png' class='plus_icon' onClick='add_sub_sub_case_mod(this);'></span>";
    newHTML += "</div>";
    newHTML += "</li>";

    $(e).closest('.module').removeClass("no_child");
    $(e).closest('.module').addClass("has_child");
    if(e.parentElement.parentElement.nextElementSibling){
      e.parentElement.parentElement.nextElementSibling.insertAdjacentHTML('beforeend', newHTML);
    }else{
      e.parentElement.parentElement.parentElement.insertAdjacentHTML('beforeend', "<ul></ul>");
      e.parentElement.parentElement.nextElementSibling.insertAdjacentHTML('beforeend', newHTML);
    }
    var class_module_main_level = main_mod_level;
    var class_module_sub_level = "sub_"+result;
    var input_val = "Level "+result;
    //toastr.success(result_textMsg+" Added.");
   }
}

function delete_case_module_confirm(e){
  const container = document.getElementById("mAlert");
  const modal = new bootstrap.Modal(container, { backdrop: true, keyboard: true });
  var url = `${SITE_URL_PROTOCOL}/assets/pages/cases/delete.html?t=` + Math.floor(Date.now() / 1000);
  $('.delete_caseModule').load(url,function(result){
    //$("#content-courseModule").attr("style", "height: 380px;top: 135px;width: 500px;border-radius: 8px !important;");
    //$(".modal-lg").attr("style","max-width: 30%;");
    var element = e;
    $("#mAlertName").text("Are you sure you want to delete Module '"+element.dataset.module_name+"'?");
    var case_module_name = e.dataset.module_name;
    var classList = e.parentElement.parentElement.parentElement.parentElement.parentElement.className.split(/\s+/);
    var num = "";
    if(classList[2] == 'main_mod'){
      num = 0;
    }else{
      var index = classList[1].lastIndexOf("_");
      var res_1 = Number(classList[1].substr(index+1));
      var result = classList[1].substr(index+1)+"."+ Number(e.parentElement.parentElement.parentElement.parentElement.childNodes.length - 8);
      num = String(result).match(/\./g).length;
    }
    if(num === 0){
      var result_textMsg = "Module:";
    }else if(num === 1){
      var result_textMsg = "Chapter:";
    }else if(num === 2){
      var result_textMsg = "Lesson:";
    }else if(num === 3){
      var result_textMsg = "Topic:";
    }else if (num === 4){
      var result_textMsg = "Sub Topic:";
    }else if (num > 4){
      var result_textMsg = "Level:";
    }
    var toastr_message = case_module_name+" Deleted successfully.";
    var case_module_id = e.dataset.case_module_id;
    var case_module_name = e.dataset.module_name;
    $("#mAlertDeleteCM").attr("data-module_id", case_module_id);
    modal.toggle();
  });
}
  /*function loadAlertModalCaseMod(toastr_message, module_id, module_name){
    $('#mAlert').on('shown.bs.modal', function (event) {
      $("#mAlertCancelCaseMod").focus();
      $(document).on('click', '#mAlertDeleteCaseMod', function(e) {console.log(e);
        console.log(module_id);
        var url_api = API_CONTENT_URL + '/case_modules/'+module_id+'/';
        var method = "DELETE";
        $.ajax({
          url: url_api,
          type: method,
          dataType: 'json',
          headers: {
            "Authorization": "Bearer " + getUserInfo().access_token,
            "Content-Type": "application/json"
          },
          success:function(response){
            $("#mAlertCancelCaseMod").click();
            //$("#case_id_mod").trigger("click");
            location.reload();
            toastr.success("Deleted Successfully.");
          },
          error: function(error){
            toastr.error("Response Error: " + error.message);
            console.log(error);
          }
        });
      });
      //mAlertCancel
      $(document).on('click', '#mAlertCancelCaseMod', function() {
        $(document).off('click', '#mAlertCancelCaseMod');
        $(document).off('click', '#mAlertDeleteCaseMod');
      });
      
    });
    
    //hidden.bs.modal 
    $('#mAlert').on('hidden.bs.modal', function (event) {
      $(document).off('click', '#mAlertCancelCaseMod');
      $(document).off('click', '#mAlertDeleteCaseMod');
      var modal = $(this);
      modal.find('.modal-content input').val(null);
      modal.find('.modal-content #mAlertName').html("Loading...");
    });
}*/
 function toInputHeader(){
  $("#case_ind_name_input").val($("#case_ind_name_text").attr("data-prev_val"));
  $("#case_ind_name_input").attr("style", "display:inline-block");
  $("#case_ind_name_input").focus();
  $("#case_ind_name_text").attr("style", "display:none");
  $("#text_edit_img_header").attr("style", "display:none");
}
function toTextHeader(){
  let case_id = document.getElementById("case_id_name").getAttribute("data-case_id");
  if($("#case_ind_name_input").val() !==""){
    var case_header_inp_val = $("#case_ind_name_input").val();
    if(case_header_inp_val.length > 256){
        toastr.error("Case Name should consist of maximum 256 character.");
      $("#case_ind_name_input").attr("style", "display:none");
      $("#case_ind_name_text").attr("style", "display:inline-block");
      $("#text_edit_img_header").attr("style", "display:inline-flex");
      return false;
    }
    var dots = "";
    if(case_header_inp_val.length > 75){
        dots = "...";
    }
    $("#case_ind_name_text").attr("data-prev_val", case_header_inp_val);
    $("#case_ind_name_text").text(case_header_inp_val.substring(0, 75)+dots);
    $("#case_ind_name_input").attr("style", "display:none");
    $("#case_ind_name_text").attr("style", "display:inline-block");
    $("#text_edit_img_header").attr("style", "display:inline-flex");
    var case_name = $("#case_ind_name_input").val();
    var member_id = $("#member_id").val();
    var case_data = {
        "name": case_name,
        "member_id" : member_id
    }
    $.ajax({
      url: API_CONTENT_URL + "/cases/"+case_id+"/",
      type: 'PATCH',
      data: JSON.stringify(case_data),
      headers: { "Content-type": "application/json; charset=UTF-8", "Authorization": "Bearer " + getUserInfo().access_token },
      success:function(response){

        toastr.success("Case Name Updated Successfully.");
      },
      error: function(error) {
        tags_response = "1";
        toastr.error("Response Error: " + error.message);
        console.log(error);
      }
    });
  }else{
        toastr.error("Case Name Should not be empty.");
  }
}

/*var remove = document.querySelector('.draggable');
function dragStart(e) {
  dragSrcEl = this;
  e.dataTransfer.effectAllowed = 'move';
  e.dataTransfer.setData('text/html', this.innerHTML);
};
 
function dragEnter(e) {
  this.classList.add('over');
}
 
function dragLeave(e) {
  e.stopPropagation();
  this.classList.remove('over');
}
 
function dragOver(e) {
  e.preventDefault();
  e.dataTransfer.dropEffect = 'move';
  return false;
}
 
function dragDrop(e) {
  console.log(this);
  console.log(dragSrcEl);
  //console.log(e.dataTransfer.getData('text/html'));
  if (dragSrcEl != this) {
    dragSrcEl.innerHTML = this.innerHTML;
    this.innerHTML = e.dataTransfer.getData('text/html');
  }
  return false;
}
 
function dragEnd(e) {
  var listItens = document.querySelectorAll('.draggable');
  [].forEach.call(listItens, function(item) {
    item.classList.remove('over');
  });
  this.style.opacity = '1';
}
 
function addEventsDragAndDrop(el) {
  el.addEventListener('dragstart', dragStart, false);
  el.addEventListener('dragenter', dragEnter, false);
  el.addEventListener('dragover', dragOver, false);
  el.addEventListener('dragleave', dragLeave, false);
  el.addEventListener('drop', dragDrop, false);
  el.addEventListener('dragend', dragEnd, false);
}*/

</script>