<div class="container-fluid">
      <div class="row">
        <div class="col-12 title-head mb-3">
          <div class="row w-100">
            <div class="col-md-6">
              <h2><span class="back" data-flinkto="courseslistlevel"><a href="#" data-flinkto="courseslistlevel"><i class="fas fa-arrow-left" data-flinkto="courseslistlevel"></i></a></span> Courses Editor  <dfn data-info="Lorem ipsum dolor sit amet, perspiciatis consectetur dolor."><i class="fas fa-info-circle"></i></dfn>
                 <span><nav aria-label="breadcrumb">
                  <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="#">Case Study List</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Case Study Builder</li>
                  </ol>
                </nav></span>  </h2>
            </div>
            <div class="col-md-6 p-0 side-btn">
              <ul>                
                  <li><span class="orange-btn"><a href="#">
                  <button>Preview</button>
                  </a></span> 
                  </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="container-fluid p-0">
      <div class="tabs white-bg p-3 mt-3">
        <input type="radio" name="tabs" id="tabone" checked="checked">
        <label for="tabone">Builder</label>
        <div class="tab p-0">
          <div class="editor-section">
             <div class="row">
                <div class="col-12">
                  <textarea id="tiny"></textarea>
                    <button class="btn btn-sm btn-primary float-end" id="save-content_mod">Save</button>
                </div>
                <div class="col-4 trackBGColor" style="display:none">
                  <div class="m-1 clearfix">
                    <span class="fs-4 float-start">Track Changes</span>
                    <button class="btn btn-sm btn-primary float-end" id="save-content">Save</button>
                  </div>
                  <div class="trackList">
                    <div class="trackSidebar"></div>
                  </div>
                </div>
              </div>
          </div>
        </div>
        <input type="radio" name="tabs" id="tabtwo">
        <!--<label for="tabtwo">Case Study Settings</label>-->
        <div class="tab p-0">
          <div class="case-section">
                  <form class="p-4">
                    <div class="row mb-3">
                      <div class="col-md-5">
                        <h4>Course Name</h4>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit ut aliquam, purus sit amet luctus venenatis</p>
                      </div>
                      <div class="col-md-7">
                        <input type="text" id="" class="form-control" placeholder="Course name">
                      </div>
                    </div>
                    <div class="row mb-3">
                      <div class="col-md-5">
                        <h4>Category</h4>
                      </div>
                      <div class="col-md-7">
                        <div class="dropdown-select">
                          <select class="form-control sort-select">
                            <option value="Project1">Select Catagory 1</option>
                            <option value="Project2">Select Catagory 2</option>
                            <option value="Project3">Select Catagory 3</option>
                            <option value="Project4">Select Catagory 4</option>
                          </select>
                        </div>
                      </div>
                    </div>
                    <div class="row mb-3">
                      <div class="col-md-5">
                        <h4>Keywords</h4>
                      </div>
                      <div class="col-md-7">
                        <textarea placeholder="Keywords"></textarea>
                      </div>
                    </div>
                    <div class="row mb-3">
                      <div class="col-md-5">
                        <h4>Sub category</h4>
                      </div>
                      <div class="col-md-7">
                        <div class="dropdown-select">
                          <select class="form-control sort-select">
                            <option value="Project1">Select sub Catagory 1</option>
                            <option value="Project2">Select sub Catagory 2</option>
                            <option value="Project3">Select sub Catagory 3</option>
                            <option value="Project4">Select sub Catagory 4</option>
                          </select>
                        </div>
                      </div>
                    </div>
                    <div class="row mb-3">
                      <div class="col-12 bottom-btn mb-3 pt-3"> <span class="orange-btn nbtn"><a href="#">
                        <button> Publish</button>
                        </a></span> </div>
                    </div>
                  </form>
                </div>
        </div>
      </div>
  
</div>
<input type="hidden" id="course_module_id" data-flinkto="courseslistlevel"/>
    </div>
    
    <script>
      var trackPath = false;
      var tinyContentData;
      tinymce.remove("#tiny");
      tinyMCE.init({
        selector: "#tiny",
        height: 600,
        width: "100%",
        menubar: false,
        branding: false,
        deprecation_warnings: false,
        image_advtab: true,
        plugins: [
          'advlist autolink lists link image charmap print preview anchor',
          'searchreplace visualblocks code fullscreen',
          'insertdatetime media table paste code help wordcount imagetools'
        ],
        toolbar: 'undo redo | link image media | formatselect | bold italic forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent charmap | removeformat | code | trackpath',
        imagetools_cors_hosts: ['localhost', 'eicit.sa'],
        imagetools_proxy: 'proxy.php',
        extended_valid_elements : "video[controls|preload|width|height|data-setup],source[src|type]",
        image_list: [
          {title: 'Zaigo', value: 'https://www.zaigoinfotech.com/wp-content/uploads/2020/11/logo.png'},
          {title: 'Exper', value: 'https://elearning.zaigoinfotech.com/assets/images/logo.png'}
        ],
        audio_template_callback: function(data) {
          return '<audio controls>' + '\n<source src="' + data.source + '"' + (data.sourcemime ? ' type="' + data.sourcemime + '"' : '') + 
            ' />\n' + (data.altsource ? '<source src="' + data.altsource + '"' + (data.altsourcemime ? ' type="' + data.altsourcemime + '"' : '') + ' />\n' : '') + '</audio>';
        },        
        setup:function(ed) {
          ed.on('init', function (e) {
            //loadextData(ed);
          });
          ed.ui.registry.addButton('trackpath', {
            icon: 'insert-time',
            tooltip: 'Toggle Track',
            onAction: function (_) {
              // ed.insertContent(toTimeHtml(new Date()));
              console.log("Before Button : " + window.trackPath);
              if(window.trackPath) {
                window.trackPath = false;
                $(".trackBGColor").hide().prev("div").removeClass("col-8").addClass("col-12");
              } else{
                window.trackPath = true;
                $(".trackBGColor").show().prev("div").removeClass("col-12").addClass("col-8");
              }
              console.log("After Button : " + window.trackPath);
            },
            onSetup: function (buttonApi) {
              var editorEventCallback = function (eventApi) {
                // buttonApi.setDisabled(window.trackPath === false);
              };
              ed.on('NodeChange', editorEventCallback);
              /* onSetup should always return the unbind handlers */
              return function (buttonApi) {
                ed.off('NodeChange', editorEventCallback);
              };
            },
          });
        }
      });

      function loadextData(ed){
        $(".trackSidebar").html("");
        var content = '';
        $.getJSON("../assets/pages/courses/data.js?t=" + Math.floor(Date.now() / 1000), function(result){
          tinyContentData = result;
          $.each(result, function(i, field){
            $(".trackSidebar").append(field.nav);
            content = field.content;
          });
          //load saved content 
          ed.setContent(content);
          //trackItems
          var selContent;
          $(".trackItems").on("click", function() {
            $(".trackItems").find("div").removeClass("active");
            var id = $(this).data("id");
            let obj = tinyContentData.find((o, i) => {
              if(o.id == id) {
                selContent = o.content;
                return true;
              }
            });
            if(selContent) {
              ed.setContent(selContent);
              $(this).find("div").addClass("active");
            }
          });
        });
      }
      
      $( document ).ready(function() {
        /*$("#save-content").on("click", function() {
          var newData = tinymce.activeEditor.getContent();
          $.post('../assets/pages/courses/savejson.php', {
            newData: newData
          }, function(response){
            // response could contain the url of the newly saved file
            loadextData(tinymce.activeEditor);
          })          
        });*/
        $("#save-content_mod").on("click", function() {
        let cid = document.getElementById("course_module_id").getAttribute("data-cid");
        let module_id = document.getElementById("course_module_id").getAttribute("data-module_id");
          var newData = tinymce.activeEditor.getContent();
          if(newData !== ''){
            var content_data = {
              "course_id": cid,
              "module_id": module_id,
              "content": newData,
              "revision_label":""
            }
            $.ajax({
              url: API_CONTENT_URL + '/course_content/',
              type: 'POST',
              data: JSON.stringify(content_data),
              contentType: "application/json; charset=utf-8",
              success:function(response){
                toastr.success("Content has been saved.");
                console.log(response);
              }
            });
          }else{
            toastr.error("Please Write a Content.");
            console.log(response);
          }
          //loadextData(tinymce.activeEditor);
        });
      });
      
    </script>