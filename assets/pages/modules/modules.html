<div class="container-fluid" style="display: none;">
    <div class="row">
      <div class="col-12">
        <div class="c-align d-flex align-center justify-cotent-center">
          <div>
            <div class="round"><img src="../assets/images/course-1.svg" /></div>
            <h4>Create your first Chapter</h4>
            <p class="role-btn"><a href="#createchapter">Create Chapter</a></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--popup start-->
  <div id="createchapter" class="overlay" style="display: block;">
    <div class="popup pt-3">
      <h4 class="mb-3">Add a new chapter</h4>
      <a class="close" href="#">×</a>
      <form method="get" class="pop-form">
        <div class="row">
          <div class="col-md-12 mb-3">
            <input type="text" id="rolename" class="form-control" placeholder="Name of the Chapter">
          </div>
          <div class="col-md-12 mb-3">
            <div class="dropdown-select">
                <select class="sort-select form-control">
                  <option value="case1">Enter Chapter Id</option>
                  <option value="case2">Chapter1</option>
                  <option value="case3">Chapter2</option>
                  <option value="case4">Chapter3</option>
                </select>
              </div>
          </div>
          <div class="col-md-12 mb-3">
            <input type="text" id="rolename" class="form-control" placeholder="Add a tag">
          </div>
          <div class="col-md-12 mb-3">
            <input type="text" id="rolename" class="form-control" placeholder="Oneline Description">
          </div>
        </div>
        <div class="row">
          <div class="col-12 pt-3 pb-3 wauto">  <span class="orange-btn nbtn"><a href="#">
            <button id="add-role">Create</button>
            </a></span> </div>
        </div>
      </form>
    </div>
  </div>
  <!--popup end-->

  <!--Chapter list start-->
  <div class="container-fluid">
    <div class="row">
      <div class="col-12 title-head mb-3">
        <h2>Chapters 
        <dfn data-info="Lorem ipsum dolor sit amet, perspiciatis consectetur dolor."><i class="fas fa-info-circle"></i></dfn></h2>
        <span class="orange-btn nbtn"><a href="#createchapter"><button id="createchapter_btn"><i class="fas fa-plus"></i> Create Module</button></a></span>
      </div>
    </div>
    <div class="row">
        <div class="col-12">
        <div class="white-bg title-head p-3">
            <div class="container-fluid p-0">
                <div class="row">
                <div class="col-lg-4 col-md-4">
                  <div class="searchbar">
                    <h4>List of Chapters 
                    <a class="btn btn-sm btn-danger btnReset d-none" style="position:relative;top:2px;float:right">Reset</a>
                    <dfn data-info="Lorem ipsum dolor sit amet, perspiciatis consectetur dolor."><i class="fas fa-info-circle"></i></dfn></h4>
                  </div>
                </div>
                <div class="col-lg-8 col-md-8 top-btn">
                    <div class="container p-0">
                        <div class="row">
                        <div class="col-lg-6 col-md-6">
                          <div class="topsearch relative">
                          <input class="form-control form-control-dark w-100" type="text" placeholder="Search here" aria-label="Search" id="searchText">
                          <i class="fas fa-search"></i> </div>
                        </div>
                        <div class="col-lg-3 col-md-3">
                        <div class="dropdown-select">
                        <select class="form-control sort-select" id="module_id">
                          <option value="Project1">All Modules</option>
                          <option value="Project2">Modules1</option>
                          <option value="Project2">Modules2</option>
                          <option value="Project3">Modules3</option>
                          <option value="Project4">Modules4</option>
                        </select>
                      </div>                        
                        </div>
                       <div class="col-lg-3 col-md-3">
                          <div class="dropdown-select">
                        <select class="form-control sort-select" id="status">
                          <option value="Recent">Recent</option>
                          <option value="Completed">Completed</option>
                          <option value="Onhold">Onhold</option>
                          <option value="To do">To do</option>
                        </select>
                      </div>
                        </div>
                  </div>
                   </div>

                </div>                
              </div>
            </div>
              </div>
            </div>
      <div class="whitebg col-md-12">
        <div class="container-fluid p-0">
          <div class="table-section">
              <table class="table table-bordered responsive">
                <thead>
                  <tr>
                    <th><div class="form-check">
                      <input class="form-check-input parentcheck" type="checkbox" value="" id="flexCheckDefault-1">
                      <label class="form-check-label" for="flexCheckDefault-1">
                      </label>
                    </div></th>
                    <th>CHAPTER ID</th>                
                    <th>NAME OF THE CHAPTER</th>
                    <th>CASE TITLE</th>
                    <th>COURSE NAME</th>
                    <th>ACTIONS</th>
                  </tr>
                </thead>
                <tbody id="listData">
                  <tr>
                    <td colspan="6">
                      <div class="alert text-center">Loading...</div>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div id="pagination-container"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--Chapter list end-->
   <!--popup start-->
  <div id="create-chapter" class="overlay" style="display: block;">
    <div class="popup medium-popup">
      
      <a class="close" href="#">×</a>
      <div class="row">
        <div class="col-md-5 br-right">
          <h4 class="mb-3">List of Modules</h4>
          <div class="row">
            <div class="col-md-6">
                <div class="topsearch relative mb-3">
                <input class="form-control form-control-dark w-100" type="text" placeholder="Search here" aria-label="Search">
                <i class="fas fa-search"></i> </div>
            </div>
            <div class="col-md-6">
              <div class="dropdown-select">
                <select class="form-control sort-select">
                  <option value="Project1">Categories</option>
                  <option value="Project2">Modules1</option>
                  <option value="Project2">Modules2</option>
                  <option value="Project3">Modules3</option>
                  <option value="Project4">Modules4</option>
                </select>
              </div>
            </div>
          </div>
          
          <div id="ccard" class="chapter-card">
            <div class="role-content mb-3" onclick="cardlist(this)">
              <h4>Module A</h4>
              <p>Lorem ipsum dolor sit amet, consectetur adip ipsum dolor sit amet, consectetur adip...</p>
              <span class="chk">
                <input type="checkbox" class="form-check-input" id="remember01">
                <label for="remember01" class="form-label"></label>
              </span>             
            </div>
            <div class="role-content mb-3" onclick="cardlist(this)">
              <h4>Module B</h4>
              <p>Lorem ipsum dolor sit amet, consectetur adip ipsum dolor sit amet, consectetur adip...</p>  
              <span class="chk">
                <input type="checkbox" class="form-check-input" id="remember02">
                <label for="remember02" class="form-label"></label>
              </span>          
            </div>
            <div class="role-content mb-3" onclick="cardlist(this)">
              <h4>Module C</h4>
              <p>Lorem ipsum dolor sit amet, consectetur adip ipsum dolor sit amet, consectetur adip...</p>
              <span class="chk">
                <input type="checkbox" class="form-check-input" id="remember03">
                <label for="remember03" class="form-label"></label>
              </span>            
            </div>
            <div class="role-content mb-3" onclick="cardlist(this)">
              <h4>Module D</h4>
              <p>Lorem ipsum dolor sit amet, consectetur adip ipsum dolor sit amet, consectetur adip...</p>
              <span class="chk">
                <input type="checkbox" class="form-check-input" id="remember04">
                <label for="remember04" class="form-label"></label>
              </span>                         
            </div>
          </div>          
        </div>
        <div class="col-md-7">
          <h4 class="mb-3">List of Chapters</h4>
          <div class="chapter-list">
            <ul class="mb-2 h-100">
              <li>Chapter1 
                <span>
                  <input type="checkbox" class="form-check-input" id="remember1">
                  <label for="remember1" class="form-label"></label>
                </span>
              </li>
              <li>Chapter2 
                <span>
                  <input type="checkbox" class="form-check-input" id="remember2">
                  <label for="remember2" class="form-label"></label>
                </span>
              </li>
              <li>Chapter3 
                <span>
                  <input type="checkbox" class="form-check-input" id="remember3">
                  <label for="remember3" class="form-label"></label>
                </span>
              </li> 
              <li>Chapter4 
                <span>
                  <input type="checkbox" class="form-check-input" id="remember4">
                  <label for="remember4" class="form-label"></label>
                </span>
              </li> 
              <li>Chapter5 
                <span>
                  <input type="checkbox" class="form-check-input" id="remember5">
                  <label for="remember5" class="form-label"></label>
                </span>
              </li> 
              <li>Chapter6 
                <span>
                  <input type="checkbox" class="form-check-input" id="remember6">
                  <label for="remember6" class="form-label"></label>
                </span>
              </li>       
            </ul>
          </div> 
          <div class="col-12 pt-3 pb-3 wauto"> <span class="border-btn nbtn"><a href="#">
            <button id="add-role-cancel">Create Chapter</button>
            </a></span> <span class="orange-btn nbtn"><a href="#">
            <button id="add-role">Add selected Chapter</button>
            </a></span> </div>         
        </div>
        </div>
      </div>
    </div>
   <!--popup end-->
   
<script>

  function doSearch(){
    var queryPara = '?self=';
    if($("#searchText").val()) {
      queryPara += "&search=" + $("#searchText").val();
    }
    //module_id
    if($("#module_id").val()) {
      queryPara += "&module_id=" + $("#module_id").val();
    }
    //status
    if($("#status").val()) {
      queryPara += "&status=" + $("#status").val();
    }

    $('#pagination-container').pagination({
      dataSource: API_CONTENT_URL + '/chapter_topic_assignments/' + queryPara,
      locator: 'data',
      totalNumberLocator: function(response) {
        return response.total;
      },
      alias: {
        pageNumber: 'page',
        pageSize: 'per_page'
      },  
      pageSize: 6,
      ajax: {
        beforeSend: function(request) {
          request.setRequestHeader("Authorization", "Bearer " + getUserInfo().access_token);
        },
        complete: function(jqXHR, textStatus) {
          if (jqXHR.status === 200 || jqXHR.readyState === 0 || jqXHR.status === 0) {
            return false; // do nothing
          } else if (jqXHR && (jqXHR.status === 403)) {
            window.location.href = SITE_URL_PROTOCOL;
          } else if (jqXHR.status === 401) {
            alert($.parseJSON(jqXHR.responseText).detail);
            window.location.href = SITE_URL_PROTOCOL;
          } else {
            alert($.parseJSON(jqXHR.responseText).detail);
          }
        },    
      },
      callback: function(data, pagination) {
        var html = template(data);
        $('#listData').html(html);
        // loadAlertModal();
      }
    });

  }
  
  function template(data) {
    var html = '';
    var sno = 0;
    if(data.length > 0) {
      $.each(data, function(index, item) {
        sno = sno + 1;
        html += '<tr>';
        html += `
        <td>
          <div class="form-check">
            <input class="form-check-input" name="chk" type="checkbox" value="`+ item.id +`" id="chk_`+ item.id +`">
            <label class="form-check-label" for="chk_`+ item.id +`"> </label>
          </div>
        </td>
        `;
        html += '<td><span class="badge bg-success gridTaskID">#'+ item.chapter_id +'</span></td>';
        html += '<td>'+ item.chapter_name +'</td>';
        html += '<td>'+ item.case_name +'</td>';
        html += '<td>'+ item.course_name +'</td>';
        
        //html += '<td>'+ getStatus(item.status) +'</td>';
        html += `
          <td class="text-center">
          <div class="dropdown ahide">
            <button class="btn dropdown-toggle dbtn btn-light" type="button" id="dropdownMenuButton3" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fas fa-ellipsis-v"></i></button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton3">`;
            
        if(item.status == '0' || item.status == '1' || item.status == '2' || item.status == '4') {
          html += `<li><a class="dropdown-item green" onClick="getModuleDetails('${item.id}')">&nbsp;Edit</a></li>`;
        } else {
          html += `<li><a class="dropdown-item green disabled">&nbsp;Edit</a></li>`;
        }
    
        html += `<li>`;
    
        if(item.status == '0' || item.status == '1') {
          html += `<a id="disabled_` + item.id + `" data-name="`+item.name+`" data-url="`+item.id+`" class="dropdown-item red mDisabled">&nbsp;Disable</a>`;
        } else if(item.status == '2') {
          html += `<a id="enabled_` + item.id + `" data-name="`+item.name+`" data-url="`+item.id+`" class="dropdown-item red mEnabled">&nbsp;Enabled</a>`;
        } else {
          html += `<a class="dropdown-item red disabled">&nbsp;Disable<a>`;
        }
    
        html += `</li><li>`;
        
        if(item.status == '2' || item.status == '3') {
          html += `<a class="dropdown-item red disabled">&nbsp;Delete<a>`;
        } else {
          html += `<a href="#mAlert" id="delete_` + item.id + `"  data-bs-toggle="modal" data-bs-target="#mAlert" data-name="`+item.name+`" data-url="`+item.id+`/"
                     class="dropdown-item red">&nbsp;Delete</a>`;
        }
        html += `</li>
            </ul>
          </div>
          </td>
        `;
        html += '</tr>';
      });
    } else {
      html += '<tr>';
      html += `
      <td>
        <div class="form-check">
          <input class="form-check-input" name="chk" type="checkbox" value="0" id="chk_0" disabled>
          <label class="form-check-label" for="chk_0"> </label>
        </div>
      </td>
      `;
      html += '<td colspan="6" class="text-center">';
      html += '<span class="text-danger">'+ window.language.no_record_found +'</span>';
      html += '</td>';
      html += '</tr>';
    }
    html += '';
    return html;
  }

  function cardlist(e){
    var elems = document.querySelector(".cardactive");
    if(elems !==null){
      elems.classList.remove("cardactive");
    }
    e.classList.add('cardactive');
  }
  
  $( document ).ready(function() {
    $(".btnReset").on("click", function(){
      $("#status, #module_id, #searchText").val(null);
      doSearch();
      setTimeout(function() {
        $(".btnReset").addClass("d-none");
      }, 500);
    });
    $(".fa-search").on("click", function(){ 
      $(".btnReset").removeClass("d-none");
      doSearch(); 
    });
    $("#status, #courses_list").on("change", function(){ doSearch(); $(".btnReset").removeClass("d-none");});
  
    if($( "#pagination-container" ).length > 0) {
      doSearch();
    }

  });
  
  async function getModuleDetails(moduleID) {
    /*
    if(processRights("modules") === false) {
      toastr.error(window.language.error_no_access);
      return false;
    }
    */
    $("#app-admin").load(
      `${SITE_URL_PROTOCOL}/assets/pages/modules/moduleslist.html`,
      function (resp, status, xhr) {
        if (status == "success" && xhr.status == 200) {
        } else {
          console.log("Something error happend");
        }
      }
    );
  }
</script>
  